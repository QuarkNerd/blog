<div class="featuredCarousel carousel slide hidden-small">
  {% comment %} Render the carousel panels but only FULL panels (there's probably a nicer way...) {% endcomment %}
  {% comment %} Rounding hack of -1, patches welcome! {% endcomment %}
  {% assign modulo = site.tags.featured | size | minus: 1 | modulo: 5 %}
  {% assign count = site.tags.featured | size | minus: modulo | divided_by: 5 %}
  <div class="carousel-inner">
    {% for i in (0..count) %}
    <div class="item {% if forloop.first %} active{% endif %}">
      <div class="row">
        <div class="span3">
          {% assign offset = i | times: 5 %}
          {% for post in site.tags.featured limit:2 offset: offset %}
          <div>
            <a href="{{ site.baseurl }}{{ post.url }}">
              <img src="{{ post.image }}">
              {% capture url %}{{ site.siteurl }}{{ site.baseurl }}{{ post.url }}{% endcapture %}
              {% if post.oldlink %}
                {% capture url %}http://www.scottlogic.co.uk{{ post.oldlink }}{% endcapture %}
              {% endif %}
              {% assign title = post.title %}
              {% assign inverted = post.featured-overlay-inverted %}
              {% include social.html %}
              <div class="carousel-caption">
                <h4>
                    {% if post.title-short %}
                    {{ post.title-short }}
                    {% else %}
                    {{ post.title | truncatewords: 6 }}
                    {% endif %}
                </h4>
              </div>
            </a>
            <cite>{{ post.image-attribution }}</cite>
          </div>
          {% endfor %}
        </div>
        <div class="span6">
          {% assign offset = offset | plus: 2 %}
          {% for post in site.tags.featured limit:1 offset:offset %}
          <div>
            <a href="{{ site.baseurl }}{{ post.url }}">
              <img src="{{ post.image }}">
              {% capture url %}{{ site.siteurl }}{{ site.baseurl }}{{ post.url }}{% endcapture %}
              {% if post.oldlink %}
                {% capture url %}http://www.scottlogic.co.uk{{ post.oldlink }}{% endcapture %}
              {% endif %}
              {% assign title = post.title %}
              {% assign inverted = post.featured-overlay-inverted %}
              {% include social.html %}
              <div class="carousel-caption">
                <h4>
                    {% if post.title-short %}
                    {{ post.title-short }}
                    {% else %}
                    {{ post.title | truncatewords: 10 }}
                    {% endif %}
                </h4>
                <p>
                    {% if post.summary-short %}
                    {{ post.summary-short }}
                    {% else %}
                    {{ post.summary | truncatewords: 50 }}
                    {% endif %}
                </p>
              </div>
            </a>
            <cite>{{ post.image-attribution }}</cite>
          </div>
          {% endfor %}
        </div>
        <div class="span3">
          {% assign offset = offset | plus: 1 %}
          {% for post in site.tags.featured limit:2 offset:offset %}
          <div>
            <a href="{{ site.baseurl }}{{ post.url }}">
              <img src="{{ post.image }}">
              {% capture url %}{{ site.siteurl }}{{ site.baseurl }}{{ post.url }}{% endcapture %}
              {% if post.oldlink %}
                {% capture url %}http://www.scottlogic.co.uk{{ post.oldlink }}{% endcapture %}
              {% endif %}
              {% assign title = post.title %}
              {% assign inverted = post.featured-overlay-inverted %}
              {% include social.html %}
              <div class="carousel-caption">
                <h4>
                    {% if post.title-short %}
                    {{ post.title-short }}
                    {% else %}
                    {{ post.title | truncatewords: 6 }}
                    {% endif %}
                </h4>
              </div>
            </a>
            <cite>{{ post.image-attribution }}</cite>
          </div>
          {% endfor %}
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
  <a class="left carousel-control" href="div.featuredCarousel" data-slide="prev"><div class="arrow left"></div></a>
  <a class="right carousel-control" href="div.featuredCarousel" data-slide="next"><div class="arrow right"></div></a>
</div>

<div class="row visible-small">
  <section class="offset2 span8">
    <h2>Featured Articles</h2>
    {% assign showPostSummary = true %}
    {% for post in site.tags.featured %}
    {% include post_summary.html %}
    {% endfor %}
  </section>
</div>