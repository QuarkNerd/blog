<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"
     xmlns:sy="http://purl.org/rss/1.0/modules/syndication/"
     xmlns:sl="scott-logic">
    <channel>
        <title><![CDATA[{% if page.author %}{{ site.authors[page.author].name }} at {% endif %}{{ site.name }}]]></title>

        {% if page.author and site.authors[page.author].description %}
        {% assign description = site.authors[page.author].description %}
        {% else %}
        {% assign description = site.description %}
        {% endif %}
        <description><![CDATA[{{ description }}]]></description>

        <link>{{ site.baseurl }}{% if page.author %}/{{ page.author }}{% endif %}</link>
        <atom:link href="{{ site.baseurl }}{% if page.author %}/{{ page.author }}{% endif %}/feed" rel="self" type="application/rss+xml" />
        <language>en-US</language>

        <sy:updatePeriod>hourly</sy:updatePeriod>
        <sy:updateFrequency>1</sy:updateFrequency>

        {% if page.author %}
        {% assign feed_posts = site.categories[page.author] %}
        {% else %}
        {% assign feed_posts = site.posts %}
        {% endif %}
        {% for post in feed_posts %}
        <item>
            <title><![CDATA[{{ post.title }}]]></title>
            <sl:title-short><![CDATA[{% if post.title-short %}{{ post.title-short }}{% else %}{{ post.title | truncatewords: 6 }}{% endif %}]]></sl:title-short>

            {% assign author = site.authors[post.author] %}
            <author>{% if author.email %}{{ author.email }} ({{ author.name }}){% else %}{{ author.name }}{% endif %}</author>

            <pubDate>{{ post.date | date_to_rfc822 }}</pubDate>

            <description><![CDATA[{% if post.summary %}{{ post.summary }}{% else %}{{ post.content | truncatewords:50 | strip_html }}{% endif %}]]></description>

            <link>{{ site.baseurl }}{{ post.url }}</link>
            <guid isPermaLink="false">{{ post.url }}</guid>

            {% for category in post.categories %}
            <category><![CDATA[{{ category }}]]></category>
            {% endfor %}

            <comments>{{ site.baseurl }}{{ post.url }}#comments</comments>
        </item>
        {% endfor %}
    </channel>
</rss>