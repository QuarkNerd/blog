---
id: 119301
author: Graham Odds
tags: 
- charts
- flex
categories: 
- Blog
layout: codds_post
---

<p>The ability to allow a user to save a Flex chart, or in fact any Flex UI component, as an image has popped up on my radar several times over the last few years.  Solutions to the problem have generally involved producing a pop-up window with the UI component as an image that the user can then save, either by bouncing the information off a server (<a href="http://www.jamesward.com/blog/2006/08/16/flex-paint-flex-display-object-to-png/" >James Ward &#8211; RIA Cowboy</a> and <a href="http://www.adobe.com/cfusion/communityengine/index.cfm?event=showdetails&amp;postId=5021&amp;productId=2&amp;loc=en_US" >Flex Cookbook</a>) or interacting with JavaScript (<a href="http://dougmccune.com/blog/2007/06/03/save-a-snapshot-image-of-a-flex-app-without-a-server/" >Doug McCune</a>).  However, additions made to the framework in Flex 3 combined with new features of Flash Player 10 have made these cumbersome techniques redundant.  It is now possible to provide this functionality directly from your Flex application in two simple steps.</p>
<p>The first step involves capturing the UI component&#8217;s bitmap information.  The Flex 3 API introduced the <a href="http://livedocs.adobe.com/flex/3/langref/mx/graphics/ImageSnapshot.html" >ImageSnapshot class</a> specifically to simplify this process.  The following line of code is sufficient to capture the image data:</p>
<div class="wp_syntax"><div class="code">{% highlight actionscript3 %}ImageSnapshot<span style="color: #000066; font-weight: bold;">.</span>captureImage<span style="color: #000000;">&#40;</span>myChart<span style="color: #000000;">&#41;</span><span style="color: #000066; font-weight: bold;">;</span>{% endhighlight %}
</div>
</div>
<p>However, we are able to control the image capturing more precisely by using some of the method&#8217;s optional parameters.  These allow us to specify the target resolution in dots per inch and the image encoder to use (the Flex 3 API provides a <a href="http://livedocs.adobe.com/flex/3/langref/mx/graphics/codec/PNGEncoder.html" >PNGEncoder</a> and a <a href="http://livedocs.adobe.com/flex/3/langref/mx/graphics/codec/JPEGEncoder.html" >JPEGEncoder</a>).   So, for example, the following line of code would capture a chart as a PNG image at a  resolution of 300dpi:</p>
<div class="wp_syntax"><div class="code">{% highlight actionscript3 %}ImageSnapshot<span style="color: #000066; font-weight: bold;">.</span>captureImage<span style="color: #000000;">&#40;</span>myChart<span style="color: #000066; font-weight: bold;">,</span> <span style="color: #000000; font-weight:bold;">300</span><span style="color: #000066; font-weight: bold;">,</span> <span style="color: #0033ff; font-weight: bold;">new</span> PNGEncoder<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span><span style="color: #000066; font-weight: bold;">;</span>{% endhighlight %}
</div>
</div>
<p>Now that we have captured the image data all that remains is the second, and last, step: saving the image data to the user&#8217;s file-system.  Flash Player 10 introduced a number of changes to its security sandbox, principally the ability to programmatically prompt the user<br />to save a file to their file-system.  This is done using the FileReference class, as shown in the following lines of code:</p>
<div class="wp_syntax"><div class="code">{% highlight actionscript3 %}<span style="color: #6699cc; font-weight: bold;">var</span> file<span style="color: #000066; font-weight: bold;">:</span><span style="color: #004993;">FileReference</span> = <span style="color: #0033ff; font-weight: bold;">new</span> <span style="color: #004993;">FileReference</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span><span style="color: #000066; font-weight: bold;">;</span>
file<span style="color: #000066; font-weight: bold;">.</span><span style="color: #004993;">save</span><span style="color: #000000;">&#40;</span>image<span style="color: #000066; font-weight: bold;">.</span><span style="color: #004993;">data</span><span style="color: #000066; font-weight: bold;">,</span> <span style="color: #990000;">&quot;chart.png&quot;</span><span style="color: #000000;">&#41;</span><span style="color: #000066; font-weight: bold;">;</span>{% endhighlight %}
</div>
</div>
<p>So, putting the steps together results in a method along the lines of the following code snippet:</p>
<div class="wp_syntax"><div class="code">{% highlight actionscript3 %}<span style="color: #3f5fbf;">/**
 * Attempts to save the chart to the user's file-system.
 */</span>
<span style="color: #0033ff; font-weight: bold;">private</span> <span style="color: #339966; font-weight: bold;">function</span> saveChart<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span><span style="color: #000066; font-weight: bold;">:</span><span style="color: #0033ff; font-weight: bold;">void</span>
<span style="color: #000000;">&#123;</span>
    <span style="color: #6699cc; font-weight: bold;">var</span> image<span style="color: #000066; font-weight: bold;">:</span>ImageSnapshot = ImageSnapshot<span style="color: #000066; font-weight: bold;">.</span>captureImage<span style="color: #000000;">&#40;</span>myChart<span style="color: #000066; font-weight: bold;">,</span> <span style="color: #000000; font-weight:bold;">300</span><span style="color: #000066; font-weight: bold;">,</span> <span style="color: #0033ff; font-weight: bold;">new</span> PNGEncoder<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span><span style="color: #000066; font-weight: bold;">;</span>
    <span style="color: #6699cc; font-weight: bold;">var</span> file<span style="color: #000066; font-weight: bold;">:</span><span style="color: #004993;">FileReference</span> = <span style="color: #0033ff; font-weight: bold;">new</span> <span style="color: #004993;">FileReference</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span><span style="color: #000066; font-weight: bold;">;</span>
    file<span style="color: #000066; font-weight: bold;">.</span><span style="color: #004993;">save</span><span style="color: #000000;">&#40;</span>image<span style="color: #000066; font-weight: bold;">.</span><span style="color: #004993;">data</span><span style="color: #000066; font-weight: bold;">,</span> <span style="color: #990000;">&quot;chart.png&quot;</span><span style="color: #000000;">&#41;</span><span style="color: #000066; font-weight: bold;">;</span>
<span style="color: #000000;">&#125;</span>{% endhighlight %}
</div>
</div>
<p>The application below shows this code in action.  The values in the data grid can be changed,<br />with the changes reflected in the chart (just to show that I&#8217;m not cheating).</p>
<p>    <object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" id="savechartobj" width="600" height="500" align="center"><param name="movie" value="http://www.scottlogic.co.uk/blog/graham/wp-content/uploads/2009/03/savechartimage.swf" /><param name="align" value="center" /><!--[if !IE]>-->      <object type="application/x-shockwave-flash" data="http://www.scottlogic.co.uk/blog/graham/wp-content/uploads/2009/03/savechartimage.swf" width="600" height="500" align="center">      <!--<![endif]--></p>
<p>      <!--[if !IE]>-->      </object>      <!--<![endif]-->    </object></p>
<p>The <a href='http://www.scottlogic.co.uk/blog/graham/wp-content/uploads/2009/03/SaveChartImage.zip'>source code</a> is now available.</p>
