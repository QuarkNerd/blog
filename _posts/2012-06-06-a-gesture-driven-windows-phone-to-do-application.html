---
id: 152450
author: Colin Eberhardt
tags: 
categories: 
- Blog
layout: ceberhardt_post
---

<p>This blog post describes the implementation of a gesture-based todo-list application. The simple interface is controlled entirely by drag, flick and swipe:</p>
<p><iframe width="480" height="360" src="http://www.youtube.com/embed/pBO75351RS4" frameborder="0" allowfullscreen></iframe></p>
<p>So far the application supports deletion and completion of tasks, but not the addition of new ones. I'll get to this in a later blog post!</p>
<h2>Introduction - gestures, why don't we use them more?</h2>
<p>I think it is fair to say that most Windows Phone applications (and mobile applications in general) have user-interfaces that are a close reflection of how we interact with a desktop computer. Mobile applications have the same buttons, checkboxes and input controls as their desktop equivalent, with the user interacting with the majority of these controls via simple clicks / taps.</p>
<p>The mobile multi-touch interface allows for much more control and expression than a simple mouse pointer device. Standard gestures have been developed such as pinch/stretch, flick, pan, tap-and-hold, however these are quite rarely used; one notable exception being pinch/stretch which is the standard mechanism for manipulating images.<br />When an application comes along that makes great use of gestures, it really stands out from the crowds. One such application is the iPhone 'Clear' application, a simple todo-list with not one button or checkbox in sight. You can see the app in action below:</p>
<p><iframe width="560" height="315" src="http://www.youtube.com/embed/5BC_bAaA1og" frameborder="0" allowfullscreen></iframe></p>
<p>Interestingly, its use of pinch to navigate the three levels of menu is similar to the <a href="http://www.scottlogic.co.uk/blog/colin/2011/11/an-introduction-to-semantic-zoom-in-windows-8-metro/">Windows 8 concept of 'semantic zoom'</a>.<br />When I first saw Clear &#8211; the clean, clutter-free interface immediately spoke 'Metro' to me! This blog post looks at how to recreate some of the features of Clear using Silverlight for Windows Phone, in order to create a gesture-driven todo application.</p>
<p>NOTE: All of the work on my blog is under a Creative Commons Share-alike licence. For this blog post I just want to add that I do <em>not </em>want someone to take this code in order to release a 'Clear' clone on the Windows Phone marketplace. This blog post is for fun and education, to make people think more about the possibilities of gestures.</p>
<h2>Rendering the to-do items</h2>
<p>I haven't followed the MVVM pattern for this simple application (I don't need to unit test or collaborate with a designer!), but have followed the standard approach of using databinding. Each item is represented by an instance of the <code>ToDoItem </code>class which has properties of <code>Text</code>, <code>Completed </code>and <code>Color </code>and implemented <code>INotifyPropertyChanged</code>.  A collection of these items is bound to an <code>ItemsControl </code>in order to render the list:</p>
<div class="wp_syntax"><div class="code">{% highlight xml %}<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ItemsControl</span> <span style="color: #000066;">ItemsSource</span>=<span style="color: #ff0000;">&quot;{Binding}&quot;</span> <span style="color: #000066;">x:Name</span>=<span style="color: #ff0000;">&quot;todoList&quot;</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ItemsControl.ItemTemplate<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;DataTemplate<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
      <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Border</span> <span style="color: #000066;">Background</span>=<span style="color: #ff0000;">&quot;{Binding Path=Color, Converter={StaticResource ColorToBrushConverter}}&quot;</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Grid<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
          <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Grid.Background<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
            <span style="color: #808080; font-style: italic;">&lt;!-- create a subtle gradient that overlays the background --&gt;</span>
            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;LinearGradientBrush</span> <span style="color: #000066;">EndPoint</span>=<span style="color: #ff0000;">&quot;0,1&quot;</span> <span style="color: #000066;">StartPoint</span>=<span style="color: #ff0000;">&quot;0,0&quot;</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
              <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;GradientStop</span> <span style="color: #000066;">Color</span>=<span style="color: #ff0000;">&quot;#22FFFFFF&quot;</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
              <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;GradientStop</span> <span style="color: #000066;">Color</span>=<span style="color: #ff0000;">&quot;#00000000&quot;</span> <span style="color: #000066;">Offset</span>=<span style="color: #ff0000;">&quot;0.1&quot;</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
              <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;GradientStop</span> <span style="color: #000066;">Color</span>=<span style="color: #ff0000;">&quot;#00000000&quot;</span> <span style="color: #000066;">Offset</span>=<span style="color: #ff0000;">&quot;0.7&quot;</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
              <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;GradientStop</span> <span style="color: #000066;">Color</span>=<span style="color: #ff0000;">&quot;#22000000&quot;</span> <span style="color: #000066;">Offset</span>=<span style="color: #ff0000;">&quot;1&quot;</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/LinearGradientBrush<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
          <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Grid.Background<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
&nbsp;
          <span style="color: #808080; font-style: italic;">&lt;!-- task text --&gt;</span>
          <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;TextBlock</span> <span style="color: #000066;">Text</span>=<span style="color: #ff0000;">&quot;{Binding Text}&quot;</span> <span style="color: #000066;">Margin</span>=<span style="color: #ff0000;">&quot;15,15,0,15&quot;</span> <span style="color: #000066;">FontSize</span>=<span style="color: #ff0000;">&quot;30&quot;</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Grid<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
      <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Border<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/DataTemplate<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/ItemsControl.ItemTemplate<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
&nbsp;
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ItemsControl.Template<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ControlTemplate</span> <span style="color: #000066;">TargetType</span>=<span style="color: #ff0000;">&quot;ItemsControl&quot;</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
      <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ScrollViewer<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ItemsPresenter</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
      <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/ScrollViewer<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/ControlTemplate<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/ItemsControl.Template<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/ItemsControl<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>{% endhighlight %}
</div>
</div>
<p>The items control is template to host the <code>ItemsPanel</code> within a <code>ScrollViewer</code>, the default panel, a vertically-oriented <code>StackPanel</code>, is used here. The template to render each item is a simple <code>Border</code>, <code>Grid </code>and <code>TextBlock</code>. The code-behind iterates over the <code>ToDoItem </code>instances setting their <code>Color </code>property to produce a pretty looking gradient from red to orange, representing the priority of each item:</p>
<p><img src="http://www.scottlogic.co.uk/blog/colin/wp-content/uploads/2012/06/list.jpg" alt="" title="list" width="300" height="545" class="aligncenter size-full wp-image-2160" /></p>
<h2>Handling gestures</h2>
<p>Silverlight for Windows Phone provides manipulation events which you can handle in order to track when a user places one or more fingers on the screen and moves them around. Turning low-level manipulation events into high-level gestures is actually quite tricky. Touch devices give a much greater control when dragging objects, or flicking them, but have a much lower accuracy for the more commonplace task of trying to hit a specific spot on the screen. For this reason, gestures have a built in tolerance. As an example, a drag manipulation gesture is not initiated if the user's finger moves by a single pixel.</p>
<p>Fortunately, the <a href="http://silverlight.codeplex.com/">Silverlight Toolkit</a> contains a <code>GestureListener </code>which handles manipulation events and turns them into the standard gesture events for you. Unless you need a quite fancy gesture (two-finger-swipe for example), the <code>GestureListener </code>probably gives you all you need. To use this class, simply attach it to the element that you want to handle gestures on, then add handlers to the events that the <code>GestureListener</code> provides.</p>
<p>We'll add a <code>GestureListener </code>to the template that is used to render each <code>ToDoItem</code>:</p>
<div class="wp_syntax"><div class="code">{% highlight xml %}<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ItemsControl</span> <span style="color: #000066;">ItemsSource</span>=<span style="color: #ff0000;">&quot;{Binding}&quot;</span> <span style="color: #000066;">x:Name</span>=<span style="color: #ff0000;">&quot;todoList&quot;</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ItemsControl.ItemTemplate<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;DataTemplate<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
      <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Border</span> <span style="color: #000066;">Background</span>=<span style="color: #ff0000;">&quot;{Binding Path=Color, Converter={StaticResource ColorToBrushConverter}}&quot;</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
        <span style="color: #808080; font-style: italic;">&lt;!-- handle gestures for the ToDoItem element --&gt;</span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;toolkit:GestureService.GestureListener<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
          <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;toolkit:GestureListener</span></span>
<span style="color: #009900;">                    <span style="color: #000066;">DragStarted</span>=<span style="color: #ff0000;">&quot;GestureListener_DragStarted&quot;</span></span>
<span style="color: #009900;">                    <span style="color: #000066;">DragDelta</span>=<span style="color: #ff0000;">&quot;GestureListener_DragDelta&quot;</span></span>
<span style="color: #009900;">                    <span style="color: #000066;">DragCompleted</span>=<span style="color: #ff0000;">&quot;GestureListener_DragCompleted&quot;</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/toolkit:GestureService.GestureListener<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
&nbsp;
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Grid<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
          ...
&nbsp;
          <span style="color: #808080; font-style: italic;">&lt;!-- task text --&gt;</span>
          <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;TextBlock</span> <span style="color: #000066;">Text</span>=<span style="color: #ff0000;">&quot;{Binding Text}&quot;</span> <span style="color: #000066;">Margin</span>=<span style="color: #ff0000;">&quot;15,15,0,15&quot;</span> <span style="color: #000066;">FontSize</span>=<span style="color: #ff0000;">&quot;30&quot;</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
&nbsp;
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Grid<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
      <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Border<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/DataTemplate<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/ItemsControl.ItemTemplate<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
&nbsp;
  ...
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/ItemsControl<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>{% endhighlight %}
</div>
</div>
<p>The events produced by the <code>GestureListener </code>are used to indicate that a user has dragged their finger across the screen, but they do not actually move the element that the listener is associated with. We need to handle these events and move the element ourselves:</p>
<div class="wp_syntax"><div class="code">{% highlight csharp %}<span style="color: #0600FF; font-weight: bold;">private</span> <span style="color: #6666cc; font-weight: bold;">void</span> GestureListener_DragStarted<span style="color: #008000;">&#40;</span><span style="color: #6666cc; font-weight: bold;">object</span> sender, DragStartedGestureEventArgs e<span style="color: #008000;">&#41;</span>
<span style="color: #008000;">&#123;</span>
  <span style="color: #008080; font-style: italic;">// initialize the drag</span>
  FrameworkElement fe <span style="color: #008000;">=</span> sender <span style="color: #0600FF; font-weight: bold;">as</span> FrameworkElement<span style="color: #008000;">;</span>
  fe<span style="color: #008000;">.</span><span style="color: #0000FF;">SetHorizontalOffset</span><span style="color: #008000;">&#40;</span><span style="color: #FF0000;">0</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>  
<span style="color: #008000;">&#125;</span>
&nbsp;
<span style="color: #0600FF; font-weight: bold;">private</span> <span style="color: #6666cc; font-weight: bold;">void</span> GestureListener_DragDelta<span style="color: #008000;">&#40;</span><span style="color: #6666cc; font-weight: bold;">object</span> sender, DragDeltaGestureEventArgs e<span style="color: #008000;">&#41;</span>
<span style="color: #008000;">&#123;</span>
  <span style="color: #008080; font-style: italic;">// handle the drag to offset the element</span>
  FrameworkElement fe <span style="color: #008000;">=</span> sender <span style="color: #0600FF; font-weight: bold;">as</span> FrameworkElement<span style="color: #008000;">;</span>
  <span style="color: #6666cc; font-weight: bold;">double</span> offset <span style="color: #008000;">=</span> fe<span style="color: #008000;">.</span><span style="color: #0000FF;">GetHorizontalOffset</span><span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">.</span><span style="color: #0000FF;">Value</span> <span style="color: #008000;">+</span> e<span style="color: #008000;">.</span><span style="color: #0000FF;">HorizontalChange</span><span style="color: #008000;">;</span>
  fe<span style="color: #008000;">.</span><span style="color: #0000FF;">SetHorizontalOffset</span><span style="color: #008000;">&#40;</span>offset<span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
<span style="color: #008000;">&#125;</span>
&nbsp;
<span style="color: #0600FF; font-weight: bold;">private</span> <span style="color: #6666cc; font-weight: bold;">void</span> GestureListener_DragCompleted<span style="color: #008000;">&#40;</span><span style="color: #6666cc; font-weight: bold;">object</span> sender, DragCompletedGestureEventArgs e<span style="color: #008000;">&#41;</span>
<span style="color: #008000;">&#123;</span>
  ToDoItemBounceBack<span style="color: #008000;">&#40;</span>fe<span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
<span style="color: #008000;">&#125;</span>{% endhighlight %}
</div>
</div>
<p>But what are these mysterious methods, <code>SetHorizontalOffset</code> and <code>GetHorizontalOffset </code>in the above code? They are not found on <code>FrameworkElement</code>. The task of offsetting an element is reasonably straightforward via a <code>TranslateTransform</code>. However, once you set the <code>RenderTransform </code>of an element, it is converted to a <code>MatrixTransform</code>, so you cannot easily retrieve the value of the offset that has just been applied.</p>
<p>In order to hide this slightly messy implementation, I have created a couple of extension methods that use <code>FrameworkElement.Tag</code> to store the current offset:</p>
<div class="wp_syntax"><div class="code">{% highlight csharp %}<span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #0600FF; font-weight: bold;">static</span> <span style="color: #6666cc; font-weight: bold;">void</span> SetHorizontalOffset<span style="color: #008000;">&#40;</span><span style="color: #0600FF; font-weight: bold;">this</span> FrameworkElement fe, <span style="color: #6666cc; font-weight: bold;">double</span> offset<span style="color: #008000;">&#41;</span>
<span style="color: #008000;">&#123;</span>
  var trans <span style="color: #008000;">=</span> <span style="color: #008000;">new</span> TranslateTransform<span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span>
  <span style="color: #008000;">&#123;</span>
    X <span style="color: #008000;">=</span> offset
  <span style="color: #008000;">&#125;</span><span style="color: #008000;">;</span>
  fe<span style="color: #008000;">.</span><span style="color: #0000FF;">RenderTransform</span> <span style="color: #008000;">=</span> trans<span style="color: #008000;">;</span>
&nbsp;
  fe<span style="color: #008000;">.</span><span style="color: #0000FF;">Tag</span> <span style="color: #008000;">=</span> <span style="color: #008000;">new</span> Offset<span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span>
    <span style="color: #008000;">&#123;</span>
      Value <span style="color: #008000;">=</span> offset,
      Transform  <span style="color: #008000;">=</span> trans
    <span style="color: #008000;">&#125;</span><span style="color: #008000;">;</span>
<span style="color: #008000;">&#125;</span>
&nbsp;
<span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #0600FF; font-weight: bold;">static</span> Offset GetHorizontalOffset<span style="color: #008000;">&#40;</span><span style="color: #0600FF; font-weight: bold;">this</span> FrameworkElement fe<span style="color: #008000;">&#41;</span>
<span style="color: #008000;">&#123;</span>
  <span style="color: #0600FF; font-weight: bold;">return</span> fe<span style="color: #008000;">.</span><span style="color: #0000FF;">Tag</span> <span style="color: #008000;">==</span> <span style="color: #0600FF; font-weight: bold;">null</span> <span style="color: #008000;">?</span> <span style="color: #008000;">new</span> Offset<span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span> <span style="color: #008000;">:</span> <span style="color: #008000;">&#40;</span>Offset<span style="color: #008000;">&#41;</span>fe<span style="color: #008000;">.</span><span style="color: #0000FF;">Tag</span><span style="color: #008000;">;</span>
<span style="color: #008000;">&#125;</span>
&nbsp;
<span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #6666cc; font-weight: bold;">struct</span> Offset
<span style="color: #008000;">&#123;</span>
  <span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #6666cc; font-weight: bold;">double</span> Value <span style="color: #008000;">&#123;</span> get<span style="color: #008000;">;</span> set<span style="color: #008000;">;</span> <span style="color: #008000;">&#125;</span>
  <span style="color: #0600FF; font-weight: bold;">public</span> TranslateTransform Transform <span style="color: #008000;">&#123;</span> get<span style="color: #008000;">;</span> set<span style="color: #008000;">;</span> <span style="color: #008000;">&#125;</span>
<span style="color: #008000;">&#125;</span>{% endhighlight %}
</div>
</div>
<p>Yes, I know, <code>Tag </code>is never an elegant solution, but at least the above code is hidden behind extension methods, so feel free to replace with a more elegant implementation using attached properties if you wish!</p>
<p>When the drag stops we want the item to bounce back into place:</p>
<div class="wp_syntax"><div class="code">{% highlight csharp %}<span style="color: #0600FF; font-weight: bold;">private</span> <span style="color: #6666cc; font-weight: bold;">void</span> ToDoItemBounceBack<span style="color: #008000;">&#40;</span>FrameworkElement fe<span style="color: #008000;">&#41;</span>
<span style="color: #008000;">&#123;</span>
  var trans <span style="color: #008000;">=</span> fe<span style="color: #008000;">.</span><span style="color: #0000FF;">GetHorizontalOffset</span><span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">.</span><span style="color: #0000FF;">Transform</span><span style="color: #008000;">;</span>
&nbsp;
  trans<span style="color: #008000;">.</span><span style="color: #0000FF;">Animate</span><span style="color: #008000;">&#40;</span>trans<span style="color: #008000;">.</span><span style="color: #0000FF;">X</span>, <span style="color: #FF0000;">0</span>, TranslateTransform<span style="color: #008000;">.</span><span style="color: #0000FF;">XProperty</span>, <span style="color: #FF0000;">300</span>, <span style="color: #FF0000;">0</span>, <span style="color: #008000;">new</span> BounceEase<span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span>
  <span style="color: #008000;">&#123;</span>
    Bounciness <span style="color: #008000;">=</span> <span style="color: #FF0000;">5</span>,
    Bounces <span style="color: #008000;">=</span> <span style="color: #FF0000;">2</span>
  <span style="color: #008000;">&#125;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
<span style="color: #008000;">&#125;</span>{% endhighlight %}
</div>
</div>
<p><code>Animate </code>is another extension method which I created in order to quickly create <code>DoubleAnimations </code>for the properties of an element:</p>
<div class="wp_syntax"><div class="code">{% highlight csharp %}<span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #0600FF; font-weight: bold;">static</span> <span style="color: #6666cc; font-weight: bold;">void</span> Animate<span style="color: #008000;">&#40;</span><span style="color: #0600FF; font-weight: bold;">this</span> DependencyObject target, <span style="color: #6666cc; font-weight: bold;">double</span> <span style="color: #0600FF; font-weight: bold;">from</span>, <span style="color: #6666cc; font-weight: bold;">double</span> to,
                          <span style="color: #6666cc; font-weight: bold;">object</span> propertyPath, <span style="color: #6666cc; font-weight: bold;">int</span> duration, <span style="color: #6666cc; font-weight: bold;">int</span> startTime,
                          IEasingFunction easing <span style="color: #008000;">=</span> <span style="color: #0600FF; font-weight: bold;">null</span>, Action completed <span style="color: #008000;">=</span> <span style="color: #0600FF; font-weight: bold;">null</span><span style="color: #008000;">&#41;</span>
<span style="color: #008000;">&#123;</span>
  <span style="color: #0600FF; font-weight: bold;">if</span> <span style="color: #008000;">&#40;</span>easing <span style="color: #008000;">==</span> <span style="color: #0600FF; font-weight: bold;">null</span><span style="color: #008000;">&#41;</span>
  <span style="color: #008000;">&#123;</span>
    easing <span style="color: #008000;">=</span> <span style="color: #008000;">new</span> SineEase<span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
  <span style="color: #008000;">&#125;</span>
&nbsp;
  var db <span style="color: #008000;">=</span> <span style="color: #008000;">new</span> DoubleAnimation<span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
  db<span style="color: #008000;">.</span><span style="color: #0000FF;">To</span> <span style="color: #008000;">=</span> to<span style="color: #008000;">;</span>
  db<span style="color: #008000;">.</span><span style="color: #0600FF; font-weight: bold;">From</span> <span style="color: #008000;">=</span> <span style="color: #0600FF; font-weight: bold;">from</span><span style="color: #008000;">;</span>
  db<span style="color: #008000;">.</span><span style="color: #0000FF;">EasingFunction</span> <span style="color: #008000;">=</span> easing<span style="color: #008000;">;</span>
  db<span style="color: #008000;">.</span><span style="color: #0000FF;">Duration</span> <span style="color: #008000;">=</span> TimeSpan<span style="color: #008000;">.</span><span style="color: #0000FF;">FromMilliseconds</span><span style="color: #008000;">&#40;</span>duration<span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
  Storyboard<span style="color: #008000;">.</span><span style="color: #0000FF;">SetTarget</span><span style="color: #008000;">&#40;</span>db, target<span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
  Storyboard<span style="color: #008000;">.</span><span style="color: #0000FF;">SetTargetProperty</span><span style="color: #008000;">&#40;</span>db, <span style="color: #008000;">new</span> PropertyPath<span style="color: #008000;">&#40;</span>propertyPath<span style="color: #008000;">&#41;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
&nbsp;
  var sb <span style="color: #008000;">=</span> <span style="color: #008000;">new</span> Storyboard<span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
  sb<span style="color: #008000;">.</span><span style="color: #0000FF;">BeginTime</span> <span style="color: #008000;">=</span> TimeSpan<span style="color: #008000;">.</span><span style="color: #0000FF;">FromMilliseconds</span><span style="color: #008000;">&#40;</span>startTime<span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
&nbsp;
  <span style="color: #0600FF; font-weight: bold;">if</span> <span style="color: #008000;">&#40;</span>completed <span style="color: #008000;">!=</span> <span style="color: #0600FF; font-weight: bold;">null</span><span style="color: #008000;">&#41;</span>
  <span style="color: #008000;">&#123;</span>
    sb<span style="color: #008000;">.</span><span style="color: #0000FF;">Completed</span> <span style="color: #008000;">+=</span> <span style="color: #008000;">&#40;</span>s, e<span style="color: #008000;">&#41;</span> <span style="color: #008000;">=&gt;</span> completed<span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
  <span style="color: #008000;">&#125;</span>
&nbsp;
  sb<span style="color: #008000;">.</span><span style="color: #0000FF;">Children</span><span style="color: #008000;">.</span><span style="color: #0000FF;">Add</span><span style="color: #008000;">&#40;</span>db<span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
  sb<span style="color: #008000;">.</span><span style="color: #0000FF;">Begin</span><span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
<span style="color: #008000;">&#125;</span>{% endhighlight %}
</div>
</div>
<p>With the above code in place, we can drag items to one side or the other, then release and watch them bounce back into place.</p>
<h2>Mark as complete</h2>
<p>When an item is dragged sufficiently far to the right, we'd like to have it marked as complete. To implement this, we'll check how far an item was dragged when the user releases their finger. If it was dragged more than half way, we'll mark the item as complete:</p>
<div class="wp_syntax"><div class="code">{% highlight csharp %}<span style="color: #0600FF; font-weight: bold;">private</span> <span style="color: #6666cc; font-weight: bold;">void</span> GestureListener_DragCompleted<span style="color: #008000;">&#40;</span><span style="color: #6666cc; font-weight: bold;">object</span> sender, DragCompletedGestureEventArgs e<span style="color: #008000;">&#41;</span>
<span style="color: #008000;">&#123;</span>  
  FrameworkElement fe <span style="color: #008000;">=</span> sender <span style="color: #0600FF; font-weight: bold;">as</span> FrameworkElement<span style="color: #008000;">;</span>
  <span style="color: #0600FF; font-weight: bold;">if</span> <span style="color: #008000;">&#40;</span>e<span style="color: #008000;">.</span><span style="color: #0000FF;">HorizontalChange</span> <span style="color: #008000;">&gt;</span> fe<span style="color: #008000;">.</span><span style="color: #0000FF;">ActualWidth</span> <span style="color: #008000;">/</span> <span style="color: #FF0000;">2</span><span style="color: #008000;">&#41;</span>
  <span style="color: #008000;">&#123;</span>
    ToDoItemCompletedAction<span style="color: #008000;">&#40;</span>fe<span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
  <span style="color: #008000;">&#125;</span>
  <span style="color: #0600FF; font-weight: bold;">else</span>
  <span style="color: #008000;">&#123;</span>
    ToDoItemBounceBack<span style="color: #008000;">&#40;</span>fe<span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
  <span style="color: #008000;">&#125;</span>
<span style="color: #008000;">&#125;</span>
&nbsp;
<span style="color: #0600FF; font-weight: bold;">private</span> <span style="color: #6666cc; font-weight: bold;">void</span> ToDoItemCompletedAction<span style="color: #008000;">&#40;</span>FrameworkElement fe<span style="color: #008000;">&#41;</span>
<span style="color: #008000;">&#123;</span>
  <span style="color: #008080; font-style: italic;">// set the ToDoItem to complete</span>
  ToDoItem completedItem <span style="color: #008000;">=</span> fe<span style="color: #008000;">.</span><span style="color: #0000FF;">DataContext</span> <span style="color: #0600FF; font-weight: bold;">as</span> ToDoItem<span style="color: #008000;">;</span>
  completedItem<span style="color: #008000;">.</span><span style="color: #0000FF;">Completed</span> <span style="color: #008000;">=</span> <span style="color: #0600FF; font-weight: bold;">true</span><span style="color: #008000;">;</span>
  completedItem<span style="color: #008000;">.</span><span style="color: #0000FF;">Color</span> <span style="color: #008000;">=</span> Colors<span style="color: #008000;">.</span><span style="color: #0000FF;">Green</span><span style="color: #008000;">;</span>
&nbsp;
  <span style="color: #008080; font-style: italic;">// bounce back into place</span>
  ToDoItemBounceBack<span style="color: #008000;">&#40;</span>fe<span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
<span style="color: #008000;">&#125;</span>{% endhighlight %}
</div>
</div>
<p>The bindings take care of updating the UI so that our item is now green. I also added a <code>Line</code> element which has its <code>Visibility </code>bound to the <code>Completed </code>property of the <code>ToDoItem</code>:</p>
<p><img src="http://www.scottlogic.co.uk/blog/colin/wp-content/uploads/2012/06/complete.jpg" alt="" title="complete" width="300" height="544" class="aligncenter size-full wp-image-2159" /></p>
<h2>Deleting an item</h2>
<p>If instead the use slides the item to the left we'd like to delete it. The <code>DragCompleted</code> event handler can easily be extended to check whether the item was dragged more than half-way across the screen in the other direction. The method that performs the deletion is shown below:</p>
<div class="wp_syntax"><div class="code">{% highlight csharp %}<span style="color: #0600FF; font-weight: bold;">private</span> <span style="color: #6666cc; font-weight: bold;">void</span> ToDoItemDeletedAction<span style="color: #008000;">&#40;</span>FrameworkElement deletedElement<span style="color: #008000;">&#41;</span>
<span style="color: #008000;">&#123;</span>
  var trans <span style="color: #008000;">=</span> deletedElement<span style="color: #008000;">.</span><span style="color: #0000FF;">GetHorizontalOffset</span><span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">.</span><span style="color: #0000FF;">Transform</span><span style="color: #008000;">;</span>
  trans<span style="color: #008000;">.</span><span style="color: #0000FF;">Animate</span><span style="color: #008000;">&#40;</span>trans<span style="color: #008000;">.</span><span style="color: #0000FF;">X</span>, <span style="color: #008000;">-</span><span style="color: #008000;">&#40;</span>deletedElement<span style="color: #008000;">.</span><span style="color: #0000FF;">ActualWidth</span> <span style="color: #008000;">+</span> <span style="color: #FF0000;">50</span><span style="color: #008000;">&#41;</span>,
                TranslateTransform<span style="color: #008000;">.</span><span style="color: #0000FF;">XProperty</span>, <span style="color: #FF0000;">300</span>, <span style="color: #FF0000;">0</span>, <span style="color: #008000;">new</span> SineEase<span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span>
  <span style="color: #008000;">&#123;</span>
    EasingMode <span style="color: #008000;">=</span> EasingMode<span style="color: #008000;">.</span><span style="color: #0000FF;">EaseOut</span>
  <span style="color: #008000;">&#125;</span>,
  <span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span> <span style="color: #008000;">=&gt;</span>
  <span style="color: #008000;">&#123;</span>
    <span style="color: #008080; font-style: italic;">// find the model object that was deleted</span>
    ToDoItem deletedItem <span style="color: #008000;">=</span> deletedElement<span style="color: #008000;">.</span><span style="color: #0000FF;">DataContext</span> <span style="color: #0600FF; font-weight: bold;">as</span> ToDoItem<span style="color: #008000;">;</span>
&nbsp;
    <span style="color: #008080; font-style: italic;">// determine how much we have to 'shuffle' up by</span>
    <span style="color: #6666cc; font-weight: bold;">double</span> elementOffset <span style="color: #008000;">=</span> <span style="color: #008000;">-</span>deletedElement<span style="color: #008000;">.</span><span style="color: #0000FF;">ActualHeight</span><span style="color: #008000;">;</span>
&nbsp;
    <span style="color: #008080; font-style: italic;">// find the items in view, and the location of the deleted item in this list</span>
    var itemsInView <span style="color: #008000;">=</span> todoList<span style="color: #008000;">.</span><span style="color: #0000FF;">GetItemsInView</span><span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">.</span><span style="color: #0000FF;">ToList</span><span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
    var lastItem <span style="color: #008000;">=</span> itemsInView<span style="color: #008000;">.</span><span style="color: #0000FF;">Last</span><span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
    <span style="color: #6666cc; font-weight: bold;">int</span> startTime <span style="color: #008000;">=</span> <span style="color: #FF0000;">0</span><span style="color: #008000;">;</span>
    <span style="color: #6666cc; font-weight: bold;">int</span> deletedItemIndex <span style="color: #008000;">=</span> itemsInView<span style="color: #008000;">.</span><span style="color: #0600FF; font-weight: bold;">Select</span><span style="color: #008000;">&#40;</span>i <span style="color: #008000;">=&gt;</span> i<span style="color: #008000;">.</span><span style="color: #0000FF;">DataContext</span><span style="color: #008000;">&#41;</span>
                                      <span style="color: #008000;">.</span><span style="color: #0000FF;">ToList</span><span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">.</span><span style="color: #0000FF;">IndexOf</span><span style="color: #008000;">&#40;</span>deletedItem<span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
&nbsp;
    <span style="color: #008080; font-style: italic;">// iterate over each item</span>
    <span style="color: #0600FF; font-weight: bold;">foreach</span> <span style="color: #008000;">&#40;</span>FrameworkElement element <span style="color: #0600FF; font-weight: bold;">in</span> itemsInView<span style="color: #008000;">.</span><span style="color: #0000FF;">Skip</span><span style="color: #008000;">&#40;</span>deletedItemIndex<span style="color: #008000;">&#41;</span><span style="color: #008000;">&#41;</span>
    <span style="color: #008000;">&#123;</span>
      <span style="color: #008080; font-style: italic;">// for the last item, create an action that deletes the model object</span>
      <span style="color: #008080; font-style: italic;">// and re-renders the list</span>
      Action action <span style="color: #008000;">=</span> <span style="color: #0600FF; font-weight: bold;">null</span><span style="color: #008000;">;</span>
      <span style="color: #0600FF; font-weight: bold;">if</span> <span style="color: #008000;">&#40;</span>element <span style="color: #008000;">==</span> lastItem<span style="color: #008000;">&#41;</span>
      <span style="color: #008000;">&#123;</span>
        action <span style="color: #008000;">=</span> <span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span> <span style="color: #008000;">=&gt;</span>
        <span style="color: #008000;">&#123;</span>
          <span style="color: #008080; font-style: italic;">// clone the list</span>
          var items <span style="color: #008000;">=</span> _todoItems<span style="color: #008000;">.</span><span style="color: #0000FF;">ToList</span><span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
          items<span style="color: #008000;">.</span><span style="color: #0000FF;">Remove</span><span style="color: #008000;">&#40;</span>deletedItem<span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
&nbsp;
          <span style="color: #008080; font-style: italic;">// re-populate our ObservableCollection</span>
          _todoItems<span style="color: #008000;">.</span><span style="color: #0000FF;">Clear</span><span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
          _todoItems<span style="color: #008000;">.</span><span style="color: #0000FF;">AddRange</span><span style="color: #008000;">&#40;</span>items<span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
          UpdateToDoColors<span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
        <span style="color: #008000;">&#125;</span><span style="color: #008000;">;</span>
      <span style="color: #008000;">&#125;</span>
&nbsp;
      <span style="color: #008080; font-style: italic;">// shuffle this item up</span>
      TranslateTransform elementTrans <span style="color: #008000;">=</span> <span style="color: #008000;">new</span> TranslateTransform<span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
      element<span style="color: #008000;">.</span><span style="color: #0000FF;">RenderTransform</span> <span style="color: #008000;">=</span> elementTrans<span style="color: #008000;">;</span>
      elementTrans<span style="color: #008000;">.</span><span style="color: #0000FF;">Animate</span><span style="color: #008000;">&#40;</span><span style="color: #FF0000;">0</span>, elementOffset, TranslateTransform<span style="color: #008000;">.</span><span style="color: #0000FF;">YProperty</span>, <span style="color: #FF0000;">200</span>, startTime, <span style="color: #0600FF; font-weight: bold;">null</span>, action<span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
      startTime <span style="color: #008000;">+=</span> <span style="color: #FF0000;">10</span><span style="color: #008000;">;</span>
    <span style="color: #008000;">&#125;</span>
  <span style="color: #008000;">&#125;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
<span style="color: #008000;">&#125;</span>{% endhighlight %}
</div>
</div>
<p>There's actually rather a lot going on in that method. Firstly the deleted item is animated so that it flies off the screen to the left. Once this animation is complete, we'd like to make the items below 'shuffle' up to fill the space. In order to do this, we measure the size of the deleted items, then iterate over all the items within the current view, that are below the deleted item, and apply an animation to each one. The code makes use of the <code>GetItemsInView</code> extension method that I wrote for the <a href="http://www.scottlogic.co.uk/blog/colin/2011/01/a-windows-phone-7-jump-list-control/" title="A Windows Phone 7 Jump List Control">WP7 JumpList control</a> - it returns a list of items that are currently visible to the user, taking vertical scroll into consideration. </p>
<p>Once all the elements have shuffled up, our UI now contains a number of <code>ToDoItems </code>that have been 'artificially' offset. Rather than try to keep track of how each item is offset, at this point we force the <code>ItemsControl </code>to re-render the entire list. </p>
<p>The result looks pretty cool ...</p>
<p><img src="http://www.scottlogic.co.uk/blog/colin/wp-content/uploads/2012/06/delete.jpg" alt="" title="delete" width="600" height="337" class="aligncenter size-full wp-image-2154" /></p>
<h2lick gestures</h2>
<p>Part of the power of manipulations is their 'organic' feel, which is why inertia and the feeling of friction are important considerations. With the current to-do application, when the user releases an item after dragging it, the item springs back to its original positions, as if it were tether via a piece of elastic. The user needs to 'pull' the item past the half way mark in order to invoke a delete / complete operation. However, in order to make the interaction feel more 'organic' the user should be able to give the todo item a short, fast flick, giving the item enough momentum to pass the critical point. In order to support this we can use the<code> GestureListener.Flick</code> event:</p>
<p>We could do a bit of physics, creating a spring-constant, give our items a nominal mass and determine whether they have ben flicked with a 'critical velocity'. However, for such a simple application, I'm happy to just come up with a velocity constant, that if passed results in the delet or complete action:</p>
<div class="wp_syntax"><div class="code">{% highlight csharp %}<span style="color: #0600FF; font-weight: bold;">private</span> <span style="color: #0600FF; font-weight: bold;">static</span> <span style="color: #6666cc; font-weight: bold;">double</span> FLICK_VELOCITY <span style="color: #008000;">=</span> <span style="color: #FF0000;">2000.0</span><span style="color: #008000;">;</span>
&nbsp;
<span style="color: #0600FF; font-weight: bold;">private</span> <span style="color: #6666cc; font-weight: bold;">void</span> GestureListener_Flick<span style="color: #008000;">&#40;</span><span style="color: #6666cc; font-weight: bold;">object</span> sender, FlickGestureEventArgs e<span style="color: #008000;">&#41;</span>
<span style="color: #008000;">&#123;</span>
  FrameworkElement fe <span style="color: #008000;">=</span> sender <span style="color: #0600FF; font-weight: bold;">as</span> FrameworkElement<span style="color: #008000;">;</span>
  <span style="color: #0600FF; font-weight: bold;">if</span> <span style="color: #008000;">&#40;</span>e<span style="color: #008000;">.</span><span style="color: #0000FF;">HorizontalVelocity</span> <span style="color: #008000;">&lt;</span> <span style="color: #008000;">-</span>FLICK_VELOCITY<span style="color: #008000;">&#41;</span>
  <span style="color: #008000;">&#123;</span>
    _flickOccured <span style="color: #008000;">=</span> <span style="color: #0600FF; font-weight: bold;">true</span><span style="color: #008000;">;</span>
    ToDoItemDeletedAction<span style="color: #008000;">&#40;</span>fe<span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
  <span style="color: #008000;">&#125;</span>
  <span style="color: #0600FF; font-weight: bold;">else</span> <span style="color: #0600FF; font-weight: bold;">if</span> <span style="color: #008000;">&#40;</span>e<span style="color: #008000;">.</span><span style="color: #0000FF;">HorizontalVelocity</span> <span style="color: #008000;">&gt;</span> FLICK_VELOCITY<span style="color: #008000;">&#41;</span>
  <span style="color: #008000;">&#123;</span>
    _flickOccured <span style="color: #008000;">=</span> <span style="color: #0600FF; font-weight: bold;">true</span><span style="color: #008000;">;</span>
    ToDoItemCompletedAction<span style="color: #008000;">&#40;</span>fe<span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>        
  <span style="color: #008000;">&#125;</span>
<span style="color: #008000;">&#125;</span>{% endhighlight %}
</div>
</div>
<h2>Contextual cues</h2>
<p>My friend Graham Odds wrote a great post on the use of <a href="http://www.scottlogic.co.uk/blog/graham/2010/05/contextual-cues-in-ui-design/">contextual cues within user-interface design</a>, which are subtle effects that in Graham's words "can be invaluable in effectively communicating the functionality and behaviour of our increasingly complex user interfaces".</p>
<p>The todo-list application uses gestures to delete / complete an item, however, these are not common use interactions so it is likely that the user would have to experiment with the application in order to discover this functionality. They would most likely have to first delete a todo-item by mistake before understanding how to perform a deletion, which could be quite frustrating!</p>
<p>In order to help the user understand the slightly novel interface, we'll add some very simple contextual cues. In the XAML below a <code>Canvas </code>has been added to the item template, this enables us to position a cross and a tick outside of the visible screen, one to the left and one to the right:</p>
<div class="wp_syntax"><div class="code">{% highlight xml %}<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Grid<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
  <span style="color: #808080; font-style: italic;">&lt;!-- add a subtle gradient over the background color for this item --&gt;</span>
  ...
&nbsp;
  <span style="color: #808080; font-style: italic;">&lt;!-- task text --&gt;</span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;TextBlock</span> <span style="color: #000066;">Text</span>=<span style="color: #ff0000;">&quot;{Binding Text}&quot;</span> <span style="color: #000066;">Margin</span>=<span style="color: #ff0000;">&quot;15,15,0,15&quot;</span> <span style="color: #000066;">FontSize</span>=<span style="color: #ff0000;">&quot;30&quot;</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
&nbsp;
  <span style="color: #808080; font-style: italic;">&lt;!-- the strike-through that is shown when a task is complete --&gt;</span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Line</span> <span style="color: #000066;">Visibility</span>=<span style="color: #ff0000;">&quot;{Binding Path=Completed, Converter={StaticResource BoolToVisibilityConverter}}&quot;</span></span>
<span style="color: #009900;">        <span style="color: #000066;">X1</span>=<span style="color: #ff0000;">&quot;0&quot;</span> <span style="color: #000066;">Y1</span>=<span style="color: #ff0000;">&quot;0&quot;</span> <span style="color: #000066;">X2</span>=<span style="color: #ff0000;">&quot;1&quot;</span> <span style="color: #000066;">Y2</span>=<span style="color: #ff0000;">&quot;0&quot;</span> </span>
<span style="color: #009900;">        <span style="color: #000066;">Stretch</span>=<span style="color: #ff0000;">&quot;UniformToFill&quot;</span></span>
<span style="color: #009900;">        <span style="color: #000066;">Stroke</span>=<span style="color: #ff0000;">&quot;White&quot;</span> <span style="color: #000066;">StrokeThickness</span>=<span style="color: #ff0000;">&quot;2&quot;</span></span>
<span style="color: #009900;">        <span style="color: #000066;">Margin</span>=<span style="color: #ff0000;">&quot;8,5,8,0&quot;</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
&nbsp;
  <span style="color: #808080; font-style: italic;">&lt;!-- a tick and a cross, rendered off screen --&gt;</span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Canvas</span> <span style="color: #000066;">Opacity</span>=<span style="color: #ff0000;">&quot;0&quot;</span> <span style="color: #000066;">x:Name</span>=<span style="color: #ff0000;">&quot;tickAndCross&quot;</span> <span style="color: #000000; font-weight: bold;">&gt;</span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;TextBlock</span> <span style="color: #000066;">Text</span>=<span style="color: #ff0000;">&quot;&times;&quot;</span> <span style="color: #000066;">FontWeight</span>=<span style="color: #ff0000;">&quot;Bold&quot;</span> <span style="color: #000066;">FontSize</span>=<span style="color: #ff0000;">&quot;35&quot;</span></span>
<span style="color: #009900;">                <span style="color: #000066;">Canvas.Left</span>=<span style="color: #ff0000;">&quot;470&quot;</span> <span style="color: #000066;">Canvas.Top</span>=<span style="color: #ff0000;">&quot;8&quot;</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;TextBlock</span> <span style="color: #000066;">Text</span>=<span style="color: #ff0000;">&quot;?&quot;</span> <span style="color: #000066;">FontWeight</span>=<span style="color: #ff0000;">&quot;Bold&quot;</span> <span style="color: #000066;">FontSize</span>=<span style="color: #ff0000;">&quot;35&quot;</span></span>
<span style="color: #009900;">                <span style="color: #000066;">Canvas.Left</span>=<span style="color: #ff0000;">&quot;-50&quot;</span> <span style="color: #000066;">Canvas.Top</span>=<span style="color: #ff0000;">&quot;8&quot;</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Canvas<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Grid<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>{% endhighlight %}
</div>
</div>
<p>In the code-behind, we can locate this <code>Canvas</code> element using <a href="http://www.scottlogic.co.uk/blog/colin/2010/03/linq-to-visual-tree/" title="Linq to Visual Tree">Linq-to-VisualTree</a>, then set the opacity so that it fades into view, with the tick and cross elements becoming more pronounced the further the user swipes:</p>
<div class="wp_syntax"><div class="code">{% highlight csharp %}<span style="color: #0600FF; font-weight: bold;">private</span> <span style="color: #6666cc; font-weight: bold;">void</span> GestureListener_DragStarted<span style="color: #008000;">&#40;</span><span style="color: #6666cc; font-weight: bold;">object</span> sender, DragStartedGestureEventArgs e<span style="color: #008000;">&#41;</span>
<span style="color: #008000;">&#123;</span>
  <span style="color: #008080; font-style: italic;">// initialize the drag</span>
  FrameworkElement fe <span style="color: #008000;">=</span> sender <span style="color: #0600FF; font-weight: bold;">as</span> FrameworkElement<span style="color: #008000;">;</span>
  fe<span style="color: #008000;">.</span><span style="color: #0000FF;">SetHorizontalOffset</span><span style="color: #008000;">&#40;</span><span style="color: #FF0000;">0</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
  _flickOccured <span style="color: #008000;">=</span> <span style="color: #0600FF; font-weight: bold;">false</span><span style="color: #008000;">;</span>
&nbsp;
  <span style="color: #008080; font-style: italic;">// find the container for the tick and cross graphics</span>
  _tickAndCrossContainer <span style="color: #008000;">=</span> fe<span style="color: #008000;">.</span><span style="color: #0000FF;">Descendants</span><span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span>
                              <span style="color: #008000;">.</span><span style="color: #0000FF;">OfType</span><span style="color: #008000;">&lt;</span>Canvas<span style="color: #008000;">&gt;</span><span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span>
                              <span style="color: #008000;">.</span><span style="color: #0000FF;">Single</span><span style="color: #008000;">&#40;</span>i <span style="color: #008000;">=&gt;</span> i<span style="color: #008000;">.</span><span style="color: #0000FF;">Name</span> <span style="color: #008000;">==</span> <span style="color: #666666;">&quot;tickAndCross&quot;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
<span style="color: #008000;">&#125;</span>
&nbsp;
<span style="color: #0600FF; font-weight: bold;">private</span> <span style="color: #6666cc; font-weight: bold;">void</span> GestureListener_DragDelta<span style="color: #008000;">&#40;</span><span style="color: #6666cc; font-weight: bold;">object</span> sender, DragDeltaGestureEventArgs e<span style="color: #008000;">&#41;</span>
<span style="color: #008000;">&#123;</span>
  <span style="color: #008080; font-style: italic;">// handle the drag to offset the element</span>
  FrameworkElement fe <span style="color: #008000;">=</span> sender <span style="color: #0600FF; font-weight: bold;">as</span> FrameworkElement<span style="color: #008000;">;</span>
  <span style="color: #6666cc; font-weight: bold;">double</span> offset <span style="color: #008000;">=</span> fe<span style="color: #008000;">.</span><span style="color: #0000FF;">GetHorizontalOffset</span><span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">.</span><span style="color: #0000FF;">Value</span> <span style="color: #008000;">+</span> e<span style="color: #008000;">.</span><span style="color: #0000FF;">HorizontalChange</span><span style="color: #008000;">;</span>
  fe<span style="color: #008000;">.</span><span style="color: #0000FF;">SetHorizontalOffset</span><span style="color: #008000;">&#40;</span>offset<span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
&nbsp;
&nbsp;
  _tickAndCrossContainer<span style="color: #008000;">.</span><span style="color: #0000FF;">Opacity</span> <span style="color: #008000;">=</span> TickAndCrossOpacity<span style="color: #008000;">&#40;</span>offset<span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
<span style="color: #008000;">&#125;</span>
&nbsp;
<span style="color: #0600FF; font-weight: bold;">private</span> <span style="color: #6666cc; font-weight: bold;">double</span> TickAndCrossOpacity<span style="color: #008000;">&#40;</span><span style="color: #6666cc; font-weight: bold;">double</span> offset<span style="color: #008000;">&#41;</span>
<span style="color: #008000;">&#123;</span>
  offset <span style="color: #008000;">=</span> Math<span style="color: #008000;">.</span><span style="color: #0000FF;">Abs</span><span style="color: #008000;">&#40;</span>offset<span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
  <span style="color: #0600FF; font-weight: bold;">if</span> <span style="color: #008000;">&#40;</span>offset <span style="color: #008000;">&lt;</span> <span style="color: #FF0000;">50</span><span style="color: #008000;">&#41;</span>
    <span style="color: #0600FF; font-weight: bold;">return</span> <span style="color: #FF0000;">0</span><span style="color: #008000;">;</span>
&nbsp;
  offset <span style="color: #008000;">-=</span> <span style="color: #FF0000;">50</span><span style="color: #008000;">;</span>
  <span style="color: #6666cc; font-weight: bold;">double</span> opacity <span style="color: #008000;">=</span> offset <span style="color: #008000;">/</span> <span style="color: #FF0000;">100</span><span style="color: #008000;">;</span>
&nbsp;
  opacity <span style="color: #008000;">=</span> Math<span style="color: #008000;">.</span><span style="color: #0000FF;">Max</span><span style="color: #008000;">&#40;</span>Math<span style="color: #008000;">.</span><span style="color: #0000FF;">Min</span><span style="color: #008000;">&#40;</span>opacity, <span style="color: #FF0000;">1</span><span style="color: #008000;">&#41;</span>, <span style="color: #FF0000;">0</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
  <span style="color: #0600FF; font-weight: bold;">return</span> opacity<span style="color: #008000;">;</span>
<span style="color: #008000;">&#125;</span>{% endhighlight %}
</div>
</div>
<p><img src="http://www.scottlogic.co.uk/blog/colin/wp-content/uploads/2012/06/gesture.jpg" alt="" title="gesture" width="600" height="170" class="aligncenter size-full wp-image-2155" /></p>
<p>With that subtle visual effect, the first iteration of my gesture-driven to-do application is complete. I&#8217;ll add new features, such as drag-to-reorder, and the ability to add / edit items in the near future, again, all driven by gestures.</p>
<p>You can download the code here: <a href='http://www.scottlogic.co.uk/blog/colin/wp-content/uploads/2012/06/ClearStyle.zip'>ClearStyle.zip</a></p>
<p><b>Update:</b> Read more about this application <a href="http://www.scottlogic.co.uk/blog/colin/2012/06/a-gesture-driven-windows-phone-todo-application-part-two-drag-re-ordering/" title="A gesture-driven Windows Phone to-do application Part Two - drag re-ordering">in part two, where I add drag re-ordering</a>.</p>
<p>Regards, Colin E.</p>
