---
id: 124922
author: Graham Odds
tags: 
- flex
categories: 
- Blog
layout: codds_post
---

<p>For reasons best ignored I recently investigated the different ways in which static initialisation code can be run in Flex.  As well as a direct equivalent to the static initialiser blocks available in <a href="http://java.sun.com/docs/books/jls/third_edition/html/classes.html#39245" >Java</a> and <a href="http://msdn.microsoft.com/en-us/library/aa645612(v=vs.71).aspx" >C#</a>, Flex has a couple of subtle variants that can prove useful in different circumstances.</p>
<p>First up, the &#8220;standard&#8221; static initialisation technique, the direct equivalent to that found in <a href="http://java.sun.com/docs/books/jls/third_edition/html/classes.html#39245" >Java</a> and <a href="http://msdn.microsoft.com/en-us/library/aa645612(v=vs.71).aspx" >C#</a>.  The block of code shown below will execute once, the first time an instance of <code>MyClass</code> is created before that first constructor call is executed.</p>
<div class="wp_syntax"><table><tr><td class="code">{% highlight actionscript %}<span style="color: #0066CC;">public</span> <span style="color: #000000; font-weight: bold;">class</span> MyClass
<span style="color: #66cc66;">&#123;</span>
    <span style="color: #0066CC;">private</span> <span style="color: #0066CC;">static</span> <span style="color: #000000; font-weight: bold;">var</span> initialised:<span style="color: #0066CC;">Boolean</span> = initialise<span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>;
    <span style="color: #0066CC;">private</span> <span style="color: #0066CC;">static</span> <span style="color: #000000; font-weight: bold;">function</span> initialise<span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>:<span style="color: #0066CC;">Boolean</span>
    <span style="color: #66cc66;">&#123;</span>
        <span style="color: #0066CC;">trace</span><span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">&quot;static initialisation block that will execute&quot;</span> +
              <span style="color: #ff0000;">&quot; the first time 'new MyClass()' is called anywhere&quot;</span><span style="color: #66cc66;">&#41;</span>;
    <span style="color: #66cc66;">&#125;</span>
<span style="color: #66cc66;">&#125;</span>{% endhighlight %}
</td>
</tr>
</table>
</div>
<p>If the intention of your code block is to create and initialise a static variable then this approach is clear and obvious.  However, if you want to run some general initialisation code you still require a dummy variable and a return type on the static function.  This is because the variable initialisation is the hook required to execute the function.  This technique was used throughout the Flex 3 Framework code for style initialisation on components (an approach no longer in Flex 4 because of the <a href="http://www.scottlogic.co.uk/blog/graham/2011/04/updating-flex-sparkline-to-flex-4/%20>improvements to style initialisation</a>).</p>
<p>The second technique is that used by the <a href="http://help.adobe.com/en_US/flex/using/WS2db454920e96a9e51e63e3d11c0bf69084-7ec5.html" >Automation framework</a> that is included with the SDK.  This approach allows code to be executed when an application or module is loaded.  The code would look as follows:</p>
<div class="wp_syntax"><table><tr><td class="code">{% highlight actionscript %}<span style="color: #66cc66;">&#91;</span>Mixin<span style="color: #66cc66;">&#93;</span>
<span style="color: #0066CC;">public</span> <span style="color: #000000; font-weight: bold;">class</span> MyClass
<span style="color: #66cc66;">&#123;</span>
    <span style="color: #0066CC;">public</span> <span style="color: #0066CC;">static</span> <span style="color: #000000; font-weight: bold;">function</span> init<span style="color: #66cc66;">&#40;</span>root:DisplayObject<span style="color: #66cc66;">&#41;</span>:<span style="color: #0066CC;">void</span>
    <span style="color: #66cc66;">&#123;</span>
        <span style="color: #0066CC;">trace</span><span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">&quot;static initialisation block that will execute&quot;</span> +
              <span style="color: #ff0000;">&quot; when the application or module first loads&quot;</span><span style="color: #66cc66;">&#41;</span>;
    <span style="color: #66cc66;">&#125;</span>
<span style="color: #66cc66;">&#125;</span>{% endhighlight %}
</td>
</tr>
</table>
</div>
<p>The <code>root</code> argument will be an <a href="http://help.adobe.com/en_US/FlashPlatform/reference/actionscript/3/mx/managers/ISystemManager.html" >ISystemManager</a> or <a href="http://help.adobe.com/en_US/FlashPlatform/reference/actionscript/3/mx/core/IFlexModuleFactory.html" >IFlexModuleFactory</a> instance depending on whether the class was loaded as part of an application or module.  Note that for the <code>[Mixin]</code> to be picked up the class must be included in the application or module, i.e. it must be referenced elsewhere in code or explicitly added using appropriate compiler arguments</p>
<p>The final technique comes from <a href="http://en.wikipedia.org/wiki/ActionScript" >ActionScript&#8217;s</a> <a href="http://en.wikipedia.org/wiki/ECMAScript" >ECMAScript</a> heritage, in particular its <a href="http://en.wikipedia.org/wiki/Prototype-based_programming" >prototype-based</a> object model.  In this case, code is written directly into the <code>class</code> scope, i.e. not inside a <code>function</code> block.  This code will be executed the first time the class is executed in any way.  That is, if the class uses the <code>[Mixin]</code> technique then it will execute along with the mix-ins <code>static init</code> function, otherwise it will be the equivalent to the &#8220;standard&#8221; approach and execute the first time the class is instantiated.</p>
<div class="wp_syntax"><table><tr><td class="code">{% highlight actionscript %}<span style="color: #0066CC;">public</span> <span style="color: #000000; font-weight: bold;">class</span> MyClass
<span style="color: #66cc66;">&#123;</span>
    <span style="color: #0066CC;">trace</span><span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">&quot;static initialisation taking advantage of prototype-based object model&quot;</span><span style="color: #66cc66;">&#41;</span>;
<span style="color: #66cc66;">&#125;</span>{% endhighlight %}
</td>
</tr>
</table>
</div>
<p><em>I know it looks odd, but it genuinely is valid!</em></p>
<p>So putting it all together in the most artificial of examples, the following class would produce the trace output 1, 2, 3, 4 (with 3 and 4 only appearing when an instance of the class is instantiated):</p>
<div class="wp_syntax"><table><tr><td class="code">{% highlight actionscript %}<span style="color: #66cc66;">&#91;</span>Mixin<span style="color: #66cc66;">&#93;</span>
<span style="color: #0066CC;">public</span> <span style="color: #000000; font-weight: bold;">function</span> MyClass
<span style="color: #66cc66;">&#123;</span>
    <span style="color: #0066CC;">trace</span><span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">&quot;1&quot;</span><span style="color: #66cc66;">&#41;</span>;
&nbsp;
    <span style="color: #0066CC;">public</span> <span style="color: #0066CC;">static</span> <span style="color: #000000; font-weight: bold;">function</span> init<span style="color: #66cc66;">&#40;</span>root:DisplayObject<span style="color: #66cc66;">&#41;</span>:<span style="color: #0066CC;">void</span>
    <span style="color: #66cc66;">&#123;</span>
        <span style="color: #0066CC;">trace</span><span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">&quot;2&quot;</span><span style="color: #66cc66;">&#41;</span>;
    <span style="color: #66cc66;">&#125;</span>
&nbsp;
    <span style="color: #0066CC;">private</span> <span style="color: #000000; font-weight: bold;">var</span> initialised:<span style="color: #0066CC;">Boolean</span> = initialise<span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>;
    <span style="color: #0066CC;">private</span> <span style="color: #000000; font-weight: bold;">function</span> initialise<span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>:<span style="color: #0066CC;">Boolean</span>
    <span style="color: #66cc66;">&#123;</span>
        <span style="color: #0066CC;">trace</span><span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">&quot;3&quot;</span><span style="color: #66cc66;">&#41;</span>;
    <span style="color: #66cc66;">&#125;</span>
&nbsp;
    <span style="color: #0066CC;">public</span> <span style="color: #000000; font-weight: bold;">function</span> MyClass<span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>
    <span style="color: #66cc66;">&#123;</span>
        <span style="color: #0066CC;">trace</span><span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">&quot;4&quot;</span><span style="color: #66cc66;">&#41;</span>;
    <span style="color: #66cc66;">&#125;</span>
<span style="color: #66cc66;">&#125;</span>{% endhighlight %}
</td>
</tr>
</table>
</div>
