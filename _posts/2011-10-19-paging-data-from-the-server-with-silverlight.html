---
id: 132238
author: Colin Eberhardt
tags: 
- codeproject
categories: 
- Blog
layout: ceberhardt_post
---

<p><em>This blog post provides an implementation of IPagedCollectionView which allows paging of data from the server. An IPagedDataSource is introduced that allows any paged data source to be plugged in, with the standard controls such as DataPager making it easy to create paging applications.</em></p>
<p>With web-based applications, bandwidth constraints often mean that when querying large datasets, the results must be paged, i.e. split into discrete pages each containing a small number of results, with an API available for moving forwards / backwards or to a specific page. There are numerous APIs available on the web that expose this type of interface, for example:</p>
<ul>
<li><a href="https://dev.twitter.com/docs/api/1/get/search">Twitter Search API</a></li>
<li><a href="http://www.nestoria.co.uk/help/api">Nestoria API</a> for searching houses for sale</li>
<li>Any of the <a href="http://www.odata.org/producers">OData producers</a></li>
</ul>
<p>With paging being a common application requirement, Silverlight has the functionality to deal with this scenario built-in. The System.Windows.Data assembly contains the <a href="http://msdn.microsoft.com/en-us/library/system.componentmodel.ipagedcollectionview(VS.95).aspx">IPagedCollectionView</a> interface, which defines the following methods, properties and events, allowing navigation of paged data:</p>
<p><img src="http://www.scottlogic.co.uk/blog/colin/wp-content/uploads/2011/10/PagedCollectionView.png" alt="" title="PagedCollectionView" width="154" height="211" class="aligncenter size-full wp-image-1756" /></p>
<p>The <code>System.Windows.Controls</code> assembly contains a <a href="http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.datapager.aspx">DataPager</a> control, that collaborates with this interface to provide a UI for paging the dataset. Simply set the Source property of this control to an instance of <code>IPagedCollectionView</code> and your user can page through the data:</p>
<p><img src="http://www.scottlogic.co.uk/blog/colin/wp-content/uploads/2011/10/DataPager.png" alt="" title="DataPager" width="312" height="33" class="aligncenter size-full wp-image-1755" /></p>
<p>NOTE: The <code>Source</code> property of <code>DataPager</code> is of type <code>IEnumerable</code>, which is a little odd, because it doesn't really need to enumerate the collection of items being displayed. Internally it probes the object you supply as the Source to see if it implements <code>IPagedCollectionView</code>, and if it does, the control becomes 'active'.</p>
<p>This control gives you quite a bit of functionality for free, the buttons become enabled / disabled based on whether navigation forwards / backwards is possible. It respects the CanChangePage property, computes the total number of pages etc &#8230;</p>
<p>So, how do you make use of this interface and control?</p>
<p>The <code>System.Windows.Data</code> assembly also contains a concrete implementation of the paging interface, <a href="http://msdn.microsoft.com/en-us/library/system.windows.data.pagedcollectionview(VS.95).aspx">PagedCollectionView</a>. This class gives much more than just paging, it also implements grouping, sorting and filtering of a source collection (<code>IEnumerable</code>). To make use of this class simply construct an instance based on your collection of data and use that as your <code>DataContext</code>:</p>
<div class="wp_syntax"><div class="code">{% highlight csharp %}List<span style="color: #008000;">&lt;</span>MyDataObject<span style="color: #008000;">&gt;</span> sourceCollection <span style="color: #008000;">=</span> ParseData<span style="color: #008000;">&#40;</span>serverResponse<span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
var collectionView <span style="color: #008000;">=</span> <span style="color: #008000;">new</span> PagedCollectionView<span style="color: #008000;">&#40;</span>sourceCollection<span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
<span style="color: #0600FF; font-weight: bold;">this</span><span style="color: #008000;">.</span><span style="color: #0000FF;">DataContext</span> <span style="color: #008000;">=</span> collectionView<span style="color: #008000;">;</span>{% endhighlight %}
</div>
</div>
<p>The problem is <code>PagedCollectionView</code> allows you to sort, group and page a collection of data that is already held in memory. What I want to do, and what I think is a more common use-case, is page data that is supplied by the server. I don't want to have to fetch all the data up-front then page it on the client, this would defeat the object of paging in the first place &#8230; to improve performance!</p>
<p>I discovered that there is an <code>IPagedCollectionView</code> implementation as part of RIA Services that provides this functionality, the <code>DomainCollectionView</code>. However, if I want to page data form a simple JSON formatted web service, adding a dependency to RIA Services seems like overkill. So I decided to create my own simple implementation of this interface.</p>
<p>In order to make a generic/ re-useable implementation of this paging interface, I first created an interface that would act as the source of the data:</p>
<div class="wp_syntax"><div class="code">{% highlight csharp %}<span style="color: #008080; font-style: italic;">/// &lt;summary&gt;</span>
<span style="color: #008080; font-style: italic;">/// Defines a source of data that can be paged.</span>
<span style="color: #008080; font-style: italic;">/// &lt;/summary&gt;</span>
<span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #6666cc; font-weight: bold;">interface</span> IPagedDataSource<span style="color: #008000;">&lt;</span>TDataType<span style="color: #008000;">&gt;</span>
<span style="color: #008000;">&#123;</span>
  <span style="color: #008080; font-style: italic;">/// &lt;summary&gt;</span>
  <span style="color: #008080; font-style: italic;">/// Asynchronously returns the data for the given page</span>
  <span style="color: #008080; font-style: italic;">/// &lt;/summary&gt;</span>
  <span style="color: #6666cc; font-weight: bold;">void</span> FetchData<span style="color: #008000;">&#40;</span><span style="color: #6666cc; font-weight: bold;">int</span> pageNumber, Action<span style="color: #008000;">&lt;</span>PagedDataResponse<span style="color: #008000;">&lt;</span>TDataType<span style="color: #008000;">&gt;&gt;</span> responseCallback<span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
<span style="color: #008000;">&#125;</span>
&nbsp;
<span style="color: #008080; font-style: italic;">/// &lt;summary&gt;</span>
<span style="color: #008080; font-style: italic;">/// The items returned as a result of a paged data request.</span>
<span style="color: #008080; font-style: italic;">/// &lt;/summary&gt;</span>
<span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #6666cc; font-weight: bold;">class</span> PagedDataResponse<span style="color: #008000;">&lt;</span>TDataType<span style="color: #008000;">&gt;</span>
<span style="color: #008000;">&#123;</span>
  <span style="color: #008080; font-style: italic;">/// &lt;summary&gt;</span>
  <span style="color: #008080; font-style: italic;">/// The items contained within the requested page</span>
  <span style="color: #008080; font-style: italic;">/// &lt;/summary&gt;</span>
  <span style="color: #0600FF; font-weight: bold;">public</span> List<span style="color: #008000;">&lt;</span>TDataType<span style="color: #008000;">&gt;</span> Items <span style="color: #008000;">&#123;</span> get<span style="color: #008000;">;</span> set<span style="color: #008000;">;</span> <span style="color: #008000;">&#125;</span>
&nbsp;
  <span style="color: #008080; font-style: italic;">/// &lt;summary&gt;</span>
  <span style="color: #008080; font-style: italic;">/// The total count of all available items</span>
  <span style="color: #008080; font-style: italic;">/// &lt;/summary&gt;</span>
  <span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #6666cc; font-weight: bold;">int</span> TotalItemCount <span style="color: #008000;">&#123;</span> get<span style="color: #008000;">;</span> set<span style="color: #008000;">;</span> <span style="color: #008000;">&#125;</span>
<span style="color: #008000;">&#125;</span>{% endhighlight %}
</div>
</div>
<p>This interface is very simple, having a single method that fetches data for the given page. The result is returned asynchronously, providing both the items within the given page and the total item count.</p>
<p>My paging collection view extends <code>ObservableCollection</code> and takes an instance of <code>IPagedDataSource</code> in its constructor:</p>
<div class="wp_syntax"><div class="code">{% highlight csharp %}<span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #6666cc; font-weight: bold;">class</span> ServerSidePagedCollectionView<span style="color: #008000;">&lt;</span>T<span style="color: #008000;">&gt;</span> <span style="color: #008000;">:</span> ObservableCollection<span style="color: #008000;">&lt;</span>T<span style="color: #008000;">&gt;</span>,
  IPagedCollectionView
<span style="color: #008000;">&#123;</span>
  IPagedDataSource<span style="color: #008000;">&lt;</span>T<span style="color: #008000;">&gt;</span> _pagedDataSource<span style="color: #008000;">;</span>
&nbsp;
  <span style="color: #0600FF; font-weight: bold;">public</span> ServerSidePagedCollectionView<span style="color: #008000;">&#40;</span>IPagedDataSource<span style="color: #008000;">&lt;</span>T<span style="color: #008000;">&gt;</span> pagedDataSource<span style="color: #008000;">&#41;</span>
  <span style="color: #008000;">&#123;</span>
    _pagedDataSource <span style="color: #008000;">=</span> pagedDataSource<span style="color: #008000;">;</span>
  <span style="color: #008000;">&#125;</span>
&nbsp;
  <span style="color: #008000;">...</span>
<span style="color: #008000;">&#125;</span>{% endhighlight %}
</div>
</div>
<p>As an aside, aren't generics great?</p>
<p>The various properties defined in <code>IPagedCollectionView</code> (<code>CanChangePage</code>, <code>TotalPages</code>, etc &#8230;) are implemented as standard field-backed properties that notify changes via <code>INotifyPropertyChanged</code> which is inherited via <code>ObservableCollection</code>, I am not going to show them here.</p>
<p>The various methods that permit navigation are all implemented using the same pattern:</p>
<div class="wp_syntax"><div class="code">{% highlight csharp %}<span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #6666cc; font-weight: bold;">bool</span> MoveToFirstPage<span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span>
<span style="color: #008000;">&#123;</span>
  RefreshData<span style="color: #008000;">&#40;</span><span style="color: #FF0000;">0</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
  <span style="color: #0600FF; font-weight: bold;">return</span> <span style="color: #0600FF; font-weight: bold;">true</span><span style="color: #008000;">;</span>
<span style="color: #008000;">&#125;</span>
&nbsp;
<span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #6666cc; font-weight: bold;">bool</span> MoveToLastPage<span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span>
<span style="color: #008000;">&#123;</span>
  RefreshData<span style="color: #008000;">&#40;</span>TotalPages <span style="color: #008000;">-</span> <span style="color: #FF0000;">1</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
  <span style="color: #0600FF; font-weight: bold;">return</span> <span style="color: #0600FF; font-weight: bold;">true</span><span style="color: #008000;">;</span>
<span style="color: #008000;">&#125;</span>    
&nbsp;
<span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #6666cc; font-weight: bold;">bool</span> MoveToNextPage<span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span>
<span style="color: #008000;">&#123;</span>
  RefreshData<span style="color: #008000;">&#40;</span>PageIndex <span style="color: #008000;">+</span> <span style="color: #FF0000;">1</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
  <span style="color: #0600FF; font-weight: bold;">return</span> <span style="color: #0600FF; font-weight: bold;">true</span><span style="color: #008000;">;</span>
<span style="color: #008000;">&#125;</span>
&nbsp;
<span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #6666cc; font-weight: bold;">bool</span> MoveToPage<span style="color: #008000;">&#40;</span><span style="color: #6666cc; font-weight: bold;">int</span> pageIndex<span style="color: #008000;">&#41;</span>
<span style="color: #008000;">&#123;</span>
  RefreshData<span style="color: #008000;">&#40;</span>pageIndex<span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
  <span style="color: #0600FF; font-weight: bold;">return</span> <span style="color: #0600FF; font-weight: bold;">true</span><span style="color: #008000;">;</span>
<span style="color: #008000;">&#125;</span>
&nbsp;
<span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #6666cc; font-weight: bold;">bool</span> MoveToPreviousPage<span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span>
<span style="color: #008000;">&#123;</span>
  RefreshData<span style="color: #008000;">&#40;</span>PageIndex <span style="color: #008000;">-</span> <span style="color: #FF0000;">1</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
  <span style="color: #0600FF; font-weight: bold;">return</span> <span style="color: #0600FF; font-weight: bold;">true</span><span style="color: #008000;">;</span>
<span style="color: #008000;">&#125;</span>{% endhighlight %}
</div>
</div>
<p>With the <code>RefreshData</code> method doing all the work, it is the only method that uses the supplied <code>IPagedDataSource</code> interface and is shown below:</p>
<div class="wp_syntax"><div class="code">{% highlight csharp %}<span style="color: #008080; font-style: italic;">/// &lt;summary&gt;</span>
<span style="color: #008080; font-style: italic;">/// Fetches the data for the given page</span>
<span style="color: #008080; font-style: italic;">/// &lt;/summary&gt;</span>
<span style="color: #0600FF; font-weight: bold;">private</span> <span style="color: #6666cc; font-weight: bold;">void</span> RefreshData<span style="color: #008000;">&#40;</span><span style="color: #6666cc; font-weight: bold;">int</span> newPageIndex<span style="color: #008000;">&#41;</span>
<span style="color: #008000;">&#123;</span>
  <span style="color: #008080; font-style: italic;">// set the pre-fetch state</span>
  CanChangePage <span style="color: #008000;">=</span> <span style="color: #0600FF; font-weight: bold;">false</span><span style="color: #008000;">;</span>
  OnPageChanging<span style="color: #008000;">&#40;</span>newPageIndex<span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
&nbsp;
  _pagedDataSource<span style="color: #008000;">.</span><span style="color: #0000FF;">FetchData</span><span style="color: #008000;">&#40;</span>newPageIndex, response <span style="color: #008000;">=&gt;</span>
    <span style="color: #008000;">&#123;</span>
      <span style="color: #008080; font-style: italic;">// process the received data</span>
      DataReceived<span style="color: #008000;">&#40;</span>response<span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
&nbsp;
      <span style="color: #008080; font-style: italic;">// set the post-fetch state</span>
      PageIndex <span style="color: #008000;">=</span> newPageIndex<span style="color: #008000;">;</span>
      OnPageChanged<span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
      CanChangePage <span style="color: #008000;">=</span> <span style="color: #0600FF; font-weight: bold;">true</span><span style="color: #008000;">;</span>
    <span style="color: #008000;">&#125;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
<span style="color: #008000;">&#125;</span>{% endhighlight %}
</div>
</div>
<p>With the simple implementation of <code>IPagedCollectionView</code> given above I can now page data from a range of web services by simply implementing <code>IPagedDataSource</code>. For example, to page data from NetFlix you can use the following implementation:</p>
<div class="wp_syntax"><div class="code">{% highlight csharp %}<span style="color: #008080; font-style: italic;">/// &lt;summary&gt;</span>
<span style="color: #008080; font-style: italic;">/// A paged NetFlix movies search datasource.</span>
<span style="color: #008080; font-style: italic;">/// &lt;/summary&gt;</span>
<span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #6666cc; font-weight: bold;">class</span> NetFlixDataSource <span style="color: #008000;">:</span> IPagedDataSource<span style="color: #008000;">&lt;</span>SyndicationItem<span style="color: #008000;">&gt;</span>
<span style="color: #008000;">&#123;</span>
  <span style="color: #0600FF; font-weight: bold;">private</span> <span style="color: #6666cc; font-weight: bold;">string</span> _searchString<span style="color: #008000;">;</span>
&nbsp;
  <span style="color: #0600FF; font-weight: bold;">private</span> <span style="color: #6666cc; font-weight: bold;">int</span> _pageSize <span style="color: #008000;">=</span> <span style="color: #FF0000;">10</span><span style="color: #008000;">;</span>
&nbsp;
  <span style="color: #0600FF; font-weight: bold;">public</span> NetFlixDataSource<span style="color: #008000;">&#40;</span><span style="color: #6666cc; font-weight: bold;">string</span> searchString<span style="color: #008000;">&#41;</span>
  <span style="color: #008000;">&#123;</span>
    _searchString <span style="color: #008000;">=</span> searchString<span style="color: #008000;">;</span>
  <span style="color: #008000;">&#125;</span>
&nbsp;
  <span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #6666cc; font-weight: bold;">void</span> FetchData<span style="color: #008000;">&#40;</span><span style="color: #6666cc; font-weight: bold;">int</span> pageNumber, Action<span style="color: #008000;">&lt;</span>PagedDataResponse<span style="color: #008000;">&lt;</span>SyndicationItem<span style="color: #008000;">&gt;&gt;</span> responseCallback<span style="color: #008000;">&#41;</span>
  <span style="color: #008000;">&#123;</span>
    WebClient client <span style="color: #008000;">=</span> <span style="color: #008000;">new</span> WebClient<span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
&nbsp;
    <span style="color: #008080; font-style: italic;">// create a url for fetching movies with a name that contains the search string</span>
    <span style="color: #6666cc; font-weight: bold;">string</span> url <span style="color: #008000;">=</span> <span style="color: #6666cc; font-weight: bold;">string</span><span style="color: #008000;">.</span><span style="color: #0000FF;">Format</span><span style="color: #008000;">&#40;</span><span style="color: #666666;">&quot;http://odata.netflix.com/Catalog/Titles?&quot;</span>
      <span style="color: #008000;">+</span> <span style="color: #666666;">&quot;$top={0}&amp;$orderby=Name&amp;$select=Name&amp;$inlinecount=allpages&amp;$skip={1}&amp;$filter=indexof(Name,'{2}') ne -1&quot;</span>,
      _pageSize, pageNumber <span style="color: #008000;">*</span> _pageSize, _searchString<span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
&nbsp;
    client<span style="color: #008000;">.</span><span style="color: #0000FF;">DownloadStringCompleted</span> <span style="color: #008000;">+=</span> <span style="color: #008000;">&#40;</span>s, e<span style="color: #008000;">&#41;</span> <span style="color: #008000;">=&gt;</span>
    <span style="color: #008000;">&#123;</span>
      <span style="color: #008080; font-style: italic;">// parse the response using SyndaicationFeed</span>
      XmlReader reader <span style="color: #008000;">=</span> XmlReader<span style="color: #008000;">.</span><span style="color: #0000FF;">Create</span><span style="color: #008000;">&#40;</span><span style="color: #008000;">new</span> StringReader<span style="color: #008000;">&#40;</span>e<span style="color: #008000;">.</span><span style="color: #0000FF;">Result</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
      SyndicationFeed feed <span style="color: #008000;">=</span> SyndicationFeed<span style="color: #008000;">.</span><span style="color: #0000FF;">Load</span><span style="color: #008000;">&#40;</span>reader<span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
&nbsp;
      <span style="color: #008080; font-style: italic;">// locate the item count </span>
      var itemCount <span style="color: #008000;">=</span> feed<span style="color: #008000;">.</span><span style="color: #0000FF;">ElementExtensions</span><span style="color: #008000;">&#91;</span><span style="color: #FF0000;">0</span><span style="color: #008000;">&#93;</span><span style="color: #008000;">.</span><span style="color: #0000FF;">GetObject</span><span style="color: #008000;">&lt;</span>XElement<span style="color: #008000;">&gt;</span><span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">.</span><span style="color: #0000FF;">Value</span><span style="color: #008000;">;</span>
&nbsp;
      <span style="color: #008080; font-style: italic;">// invoke the response callback</span>
      responseCallback<span style="color: #008000;">&#40;</span><span style="color: #008000;">new</span> PagedDataResponse<span style="color: #008000;">&lt;</span>SyndicationItem<span style="color: #008000;">&gt;</span><span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span>
      <span style="color: #008000;">&#123;</span>
        Items <span style="color: #008000;">=</span> feed<span style="color: #008000;">.</span><span style="color: #0000FF;">Items</span><span style="color: #008000;">.</span><span style="color: #0000FF;">ToList</span><span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span>,
        TotalItemCount <span style="color: #008000;">=</span> <span style="color: #6666cc; font-weight: bold;">int</span><span style="color: #008000;">.</span><span style="color: #0000FF;">Parse</span><span style="color: #008000;">&#40;</span>itemCount<span style="color: #008000;">&#41;</span>
      <span style="color: #008000;">&#125;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
    <span style="color: #008000;">&#125;</span><span style="color: #008000;">;</span>
    client<span style="color: #008000;">.</span><span style="color: #0000FF;">DownloadStringAsync</span><span style="color: #008000;">&#40;</span><span style="color: #008000;">new</span> Uri<span style="color: #008000;">&#40;</span>url<span style="color: #008000;">&#41;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
  <span style="color: #008000;">&#125;</span>
<span style="color: #008000;">&#125;</span>{% endhighlight %}
</div>
</div>
<p>As you can see, this simple implementation of our paging data source constructs the required URL based on the search string and request page number. It also uses the 'syndication' APIs which are able to parse the response from the NetFlix OData APIs.</p>
<p>To test out this implementation of the paged search interface I have created a very simple movie search application. The view model for this application has a <code>SearchString</code> property, exposes the results as <code>SearchResults</code> property and has a single command which initiates a new search. The important parts of this class are shown below:</p>
<div class="wp_syntax"><div class="code">{% highlight csharp %}<span style="color: #008080; font-style: italic;">/// &lt;summary&gt;</span>
<span style="color: #008080; font-style: italic;">/// Gets the paged search results</span>
<span style="color: #008080; font-style: italic;">/// &lt;/summary&gt;</span>
<span style="color: #0600FF; font-weight: bold;">public</span> ServerSidePagedCollectionView<span style="color: #008000;">&lt;</span>SyndicationItem<span style="color: #008000;">&gt;</span> SearchResults
<span style="color: #008000;">&#123;</span>
  get
  <span style="color: #008000;">&#123;</span>
    <span style="color: #0600FF; font-weight: bold;">return</span> _searchResults<span style="color: #008000;">;</span>
  <span style="color: #008000;">&#125;</span>
  <span style="color: #0600FF; font-weight: bold;">private</span> set
  <span style="color: #008000;">&#123;</span>
    SetField<span style="color: #008000;">&#40;</span><span style="color: #0600FF; font-weight: bold;">ref</span> _searchResults, value, <span style="color: #666666;">&quot;SearchResults&quot;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
  <span style="color: #008000;">&#125;</span>
<span style="color: #008000;">&#125;</span>
&nbsp;
<span style="color: #008080; font-style: italic;">/// &lt;summary&gt;</span>
<span style="color: #008080; font-style: italic;">/// Gets a command which executes the search</span>
<span style="color: #008080; font-style: italic;">/// &lt;/summary&gt;</span>
<span style="color: #0600FF; font-weight: bold;">public</span> ICommand ExecuteSearchCommand
<span style="color: #008000;">&#123;</span>
  get
  <span style="color: #008000;">&#123;</span>
    <span style="color: #0600FF; font-weight: bold;">return</span> <span style="color: #008000;">new</span> DelegateCommand<span style="color: #008000;">&#40;</span><span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span> <span style="color: #008000;">=&gt;</span>
    <span style="color: #008000;">&#123;</span>
      SearchResults <span style="color: #008000;">=</span> <span style="color: #008000;">new</span> ServerSidePagedCollectionView<span style="color: #008000;">&lt;</span>SyndicationItem<span style="color: #008000;">&gt;</span><span style="color: #008000;">&#40;</span>
        <span style="color: #008000;">new</span> NetFlixDataSource<span style="color: #008000;">&#40;</span>SearchText<span style="color: #008000;">&#41;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
    <span style="color: #008000;">&#125;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
  <span style="color: #008000;">&#125;</span>
<span style="color: #008000;">&#125;</span>{% endhighlight %}
</div>
</div>
<p>When <code>ExecuteSearchCommand</code> is invoked, we create a new <code>ServerSidePagedCollectionView</code>, providing it with the NetFlix data source.  From here on, the <code>ServerSidePagedCollectionView</code> is responsible for the paging of data.</p>
<p>The view is as follows:</p>
<div class="wp_syntax"><div class="code">{% highlight xml %}<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Grid</span> <span style="color: #000066;">x:Name</span>=<span style="color: #ff0000;">&quot;LayoutRoot&quot;</span> <span style="color: #000066;">Background</span>=<span style="color: #ff0000;">&quot;LightGray&quot;</span></span>
<span style="color: #009900;">      <span style="color: #000066;">Width</span>=<span style="color: #ff0000;">&quot;400&quot;</span> <span style="color: #000066;">Height</span>=<span style="color: #ff0000;">&quot;360&quot;</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Grid.RowDefinitions<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;RowDefinition</span> <span style="color: #000066;">Height</span>=<span style="color: #ff0000;">&quot;Auto&quot;</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;RowDefinition</span> <span style="color: #000066;">Height</span>=<span style="color: #ff0000;">&quot;Auto&quot;</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;RowDefinition</span> <span style="color: #000066;">Height</span>=<span style="color: #ff0000;">&quot;Auto&quot;</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Grid.RowDefinitions<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
&nbsp;
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;StackPanel</span> <span style="color: #000066;">Orientation</span>=<span style="color: #ff0000;">&quot;Horizontal&quot;</span></span>
<span style="color: #009900;">              <span style="color: #000066;">Margin</span>=<span style="color: #ff0000;">&quot;4&quot;</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;TextBox</span> <span style="color: #000066;">Text</span>=<span style="color: #ff0000;">&quot;{Binding SearchText, Mode=TwoWay}&quot;</span></span>
<span style="color: #009900;">                <span style="color: #000066;">Width</span>=<span style="color: #ff0000;">&quot;150&quot;</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Button</span> <span style="color: #000066;">Command</span>=<span style="color: #ff0000;">&quot;{Binding ExecuteSearchCommand}&quot;</span></span>
<span style="color: #009900;">            <span style="color: #000066;">Content</span>=<span style="color: #ff0000;">&quot; Search Movies ...&quot;</span></span>
<span style="color: #009900;">            <span style="color: #000066;">Margin</span>=<span style="color: #ff0000;">&quot;5,0,0,0&quot;</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/StackPanel<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
&nbsp;
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ItemsControl</span> <span style="color: #000066;">ItemsSource</span>=<span style="color: #ff0000;">&quot;{Binding SearchResults}&quot;</span></span>
<span style="color: #009900;">                <span style="color: #000066;">Grid.Row</span>=<span style="color: #ff0000;">&quot;1&quot;</span></span>
<span style="color: #009900;">                <span style="color: #000066;">Height</span>=<span style="color: #ff0000;">&quot;300&quot;</span></span>
<span style="color: #009900;">                <span style="color: #000066;">ItemTemplate</span>=<span style="color: #ff0000;">&quot;{StaticResource MovieTemplate}&quot;</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ItemsControl.ItemsPanel<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
      <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ItemsPanelTemplate<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;StackPanel</span> <span style="color: #000066;">Orientation</span>=<span style="color: #ff0000;">&quot;Vertical&quot;</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
      <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/ItemsPanelTemplate<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/ItemsControl.ItemsPanel<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/ItemsControl<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Rectangle</span> <span style="color: #000066;">Fill</span>=<span style="color: #ff0000;">&quot;White&quot;</span> <span style="color: #000066;">Grid.Row</span>=<span style="color: #ff0000;">&quot;1&quot;</span></span>
<span style="color: #009900;">            <span style="color: #000066;">Opacity</span>=<span style="color: #ff0000;">&quot;0.5&quot;</span></span>
<span style="color: #009900;">            <span style="color: #000066;">Visibility</span>=<span style="color: #ff0000;">&quot;{Binding Path=SearchResults.CanChangePage, Converter={StaticResource BoolToVisibilityConverter}}&quot;</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
&nbsp;
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;sdk:DataPager</span>  <span style="color: #000066;">PageSize</span>=<span style="color: #ff0000;">&quot;10&quot;</span> </span>
<span style="color: #009900;">                  <span style="color: #000066;">Source</span>=<span style="color: #ff0000;">&quot;{Binding SearchResults}&quot;</span></span>
<span style="color: #009900;">                  <span style="color: #000066;">Grid.Row</span>=<span style="color: #ff0000;">&quot;2&quot;</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
&nbsp;
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Grid<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>{% endhighlight %}
</div>
</div>
<p>The DataPager simply binds to the <code>SearchResults</code> as does the ItemsControl. I have also added a <code>Rectangle</code> element which grays-out the current search results when a new page is being fetched.</p>
<p>You can see the application in action below:</p>
<div style="text-align: center;"><object width="500" height="400" data="data:application/x-silverlight," type="application/x-silverlight-2" ><param name="source" value="http://www.scottlogic.co.uk/blog/colin/wp-content/uploads/2011/10/PagedCollectionViewExample.xap"/><a href="http://go.microsoft.com/fwlink/?LinkID=124807"  style="text-decoration: none;"> <img src="http://go.microsoft.com/fwlink/?LinkId=108181" alt="Get Microsoft Silverlight" style="border-style: none"/></a></object></div>
<p>So in summary, by implementing <code>IPagedCollectionView</code> with a pluggable datasource, <code>IPagedDataSource</code>, it is possible to very quickly and easily create an application that pages data from the server.</p>
<p>You can download the full sourcecode here: <a href='http://www.scottlogic.co.uk/blog/colin/wp-content/uploads/2011/10/PagedCollectionViewExample.zip'>PagedCollectionViewExample.zip</a></p>
<p>Regards, Colin E.</p>
